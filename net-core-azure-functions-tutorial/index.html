<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>.NET Core Azure Functions Tutorial - David Haney - Blogging my experiences as a developer and engineering manager.</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David Haney" />
  <meta name="description" content="In this post I&amp;rsquo;d like to show you how I ported an Azure Classic Cloud Service application (which cost me $16 USD a month by the way) to a .NET Core Azure Function, and now host it in Azure for $0 a month! That&amp;rsquo;s right - Azure Functions are both awesome and (usually) free!
Introducing realDonaldTron So back in late 2016, when our dear leader was elected president, I decided to have a little fun at his expense." />

  <meta name="keywords" content="blog, .net, c#, developer, manager, david, haney, david haney, davidhaney, haneytron, haneycodes, stack overflow, stackoverflow, code, stack, overflow, github, twitter, linkedin" />






<meta name="generator" content="Hugo 0.41" />


<link rel="canonical" href="https://www.davidhaney.io/net-core-azure-functions-tutorial/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.1.1" rel="preload" as="style">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="preload" as="style">



<link href="/css/custom.css" rel="preload" as="style">


<meta property="og:title" content=".NET Core Azure Functions Tutorial" />
<meta property="og:description" content="In this post I&rsquo;d like to show you how I ported an Azure Classic Cloud Service application (which cost me $16 USD a month by the way) to a .NET Core Azure Function, and now host it in Azure for $0 a month! That&rsquo;s right - Azure Functions are both awesome and (usually) free!
Introducing realDonaldTron So back in late 2016, when our dear leader was elected president, I decided to have a little fun at his expense." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.davidhaney.io/net-core-azure-functions-tutorial/" />



<meta property="article:published_time" content="2018-11-19T00:00:00-05:00"/>

<meta property="article:modified_time" content="2018-11-19T00:00:00-05:00"/>











<meta itemprop="name" content=".NET Core Azure Functions Tutorial">
<meta itemprop="description" content="In this post I&rsquo;d like to show you how I ported an Azure Classic Cloud Service application (which cost me $16 USD a month by the way) to a .NET Core Azure Function, and now host it in Azure for $0 a month! That&rsquo;s right - Azure Functions are both awesome and (usually) free!
Introducing realDonaldTron So back in late 2016, when our dear leader was elected president, I decided to have a little fun at his expense.">


<meta itemprop="datePublished" content="2018-11-19T00:00:00-05:00" />
<meta itemprop="dateModified" content="2018-11-19T00:00:00-05:00" />
<meta itemprop="wordCount" content="2324">



<meta itemprop="keywords" content="dotnet,core,csharp,azure,functions," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=".NET Core Azure Functions Tutorial"/>
<meta name="twitter:description" content="In this post I&rsquo;d like to show you how I ported an Azure Classic Cloud Service application (which cost me $16 USD a month by the way) to a .NET Core Azure Function, and now host it in Azure for $0 a month! That&rsquo;s right - Azure Functions are both awesome and (usually) free!
Introducing realDonaldTron So back in late 2016, when our dear leader was elected president, I decided to have a little fun at his expense."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David Haney</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David Haney</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">.NET Core Azure Functions Tutorial</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-11-19 </span>
        <div class="post-category">
            
              <a href="/categories/blog/"> blog </a>
            
          </div>
        <span class="more-meta"> 2324 words </span>
        <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#introducing-realdonaldtron">Introducing realDonaldTron</a></li>
<li><a href="#porting-net-to-net-core">Porting .NET to .NET Core</a></li>
<li><a href="#hosting-in-azure-don-t-use-webjobs">Hosting in Azure: Don&rsquo;t use WebJobs</a>
<ul>
<li><a href="#webjobs-time-out">WebJobs time out</a></li>
<li><a href="#always-on-isn-t-cheap">Always On isn&rsquo;t cheap</a></li>
<li><a href="#webjobs-for-web-sites">WebJobs for web sites</a></li>
</ul></li>
<li><a href="#hosting-in-azure-use-azure-functions">Hosting in Azure: Use Azure Functions</a>
<ul>
<li><a href="#pricing">Pricing</a></li>
<li><a href="#monthly-free-grants">Monthly free grants!</a></li>
<li><a href="#what-does-realdonaldtron-cost">What does realDonaldTron cost?</a></li>
<li><a href="#a-caveat-about-azure-function-logging">A caveat about Azure Function logging</a></li>
</ul></li>
<li><a href="#creating-an-azure-function-in-vs">Creating an Azure Function in VS</a></li>
<li><a href="#the-end-result">The end result</a></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<p>In this post I&rsquo;d like to show you how I ported an Azure Classic Cloud Service application (which cost me $16 USD a month by the way) to a .NET Core Azure Function, and now host it in Azure for $0 a month! That&rsquo;s right - Azure Functions are both awesome and (usually) free!</p>

<h1 id="introducing-realdonaldtron">Introducing realDonaldTron</h1>

<p>So back in late 2016, when our dear leader was elected president, I decided to have a little fun at his expense. I created a <a href="https://www.twitter.com/realDonaldTron">Twitter account</a> and generated API keys. I then created an Azure Classic Cloud Service and
wrote a quick and dirty Twitter bot. This bot consumes 1000s of the most recent tweets from Donald Trump, cleans up his grammar and punctuation a little (because he can&rsquo;t write words good), generates a <a href="https://en.wikipedia.org/wiki/Markov_chain">Markov Chain</a>
from the Tweets, and then schedules a .NET Timer to generate and publish a new Tweet at the top of every hour.</p>

<p>Here&rsquo;s what the startup code roughly looked like:</p>

<pre><code>public void Start()
{
    // Twitter API keys
    var consumerKey = &quot;*********&quot;;
    var consumerSecret = &quot;*********&quot;;
    var userAccessToken = &quot;*********&quot;;
    var userAccessSecret = &quot;*********&quot;;

    // Set credentials
    Auth.SetUserCredentials(consumerKey, consumerSecret, userAccessToken, userAccessSecret);

    // Build the Markhov chain
    Console.WriteLine(&quot;Building Markhov Chain...&quot;);
    BuildMarkhovChain();
    Console.WriteLine(&quot;Built! {0} root nodes&quot;, _markhovTreeRoot.Children.Count);

    // Start generating tweets
    Console.WriteLine(&quot;Starting Tweets...&quot;);
    Console.WriteLine();

    // Configure timers
    var timeUntilNextHour = GetTimeUntilNextHour();
    // GenerateTweet ends by adjusting timer again for next hour, to avoid clock drift
    _tweetTimer = new Timer(GenerateTweet, null, timeUntilNextHour, Timeout.Infinite);
    // Rebuild the Markov chain once per day from the newest Tweets
    _buildMarkhovChainTimer 
        = new Timer(BuildMarkhovChain, null, 24 * 60 * 60 * 1000, 24 * 60 * 60 * 1000);
}
</code></pre>

<p>I find this bot quite amusing. It sometimes creates hilarious statements:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">EXTREME bias of me is negative (Fake). Dow RISES 5000 POINTS ON THE subject, it is amazing how a manager takes out a pitcher who is like a choirboy.</p>&mdash; Donald J. Tron (@realDonaldTron) <a href="https://twitter.com/realDonaldTron/status/1061423338613080064?ref_src=twsrc%5Etfw">November 11, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Lunatic who should definitely be given $700,000 for campaign by the purposely false and Dishonest reporting that they would start buying soybeans from our military Vets.</p>&mdash; Donald J. Tron (@realDonaldTron) <a href="https://twitter.com/realDonaldTron/status/1060758970321788929?ref_src=twsrc%5Etfw">November 9, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thugs spent over hours with the Crown Prince of Saudi Arabia who totally denied any knowledge of what took place during the terrible boat accident which just took a year low!</p>&mdash; Donald J. Tron (@realDonaldTron) <a href="https://twitter.com/realDonaldTron/status/1056153540668866561?ref_src=twsrc%5Etfw">October 27, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>However, I was getting a little tired of paying $16 a month to host it as an Azure Classic Cloud Service. Given my thrifty nature combined with my interest in building my first .NET Core application, I thought a great first step would be to port realDonaldTron over. And so I did!</p>

<h1 id="porting-net-to-net-core">Porting .NET to .NET Core</h1>

<p>Porting a .NET application over to .NET Core is usually not too terrible. I found the easiest way was to create a new .NET Core solution using Visual Studio, drag and drop my directory structure over to my new directory, install all of the NuGet packages that I needed in my old
solution (many will have a netstandard specific version for .NET Core), and then attempt to compile and correct errors, Googling (or Stack Overflowing) for new APIs where old calls no longer existed. I needed to make very few changes to realDonaldTron in order to get him working.</p>

<p>I was also pleasantly surprised at how simple the new .csproj file structure is. By default, <em>everything in the folder is included in the project</em> except where you specify exceptions. This makes for a pretty clean file. Here&rsquo;s the .NET Core realDonaldTron .csproj file:</p>

<pre><code>&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;
    &lt;LangVersion&gt;latest&lt;/LangVersion&gt;
    &lt;AzureFunctionsVersion&gt;v2&lt;/AzureFunctionsVersion&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.NET.Sdk.Functions&quot; Version=&quot;1.0.*&quot; /&gt;
    &lt;PackageReference Include=&quot;TweetinviAPI&quot; Version=&quot;4.0.0&quot; /&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;
    &lt;None Update=&quot;host.json&quot;&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
    &lt;/None&gt;
    &lt;None Update=&quot;local.settings.json&quot;&gt;
      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
      &lt;CopyToPublishDirectory&gt;Never&lt;/CopyToPublishDirectory&gt;
    &lt;/None&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>

<p>A welcomed change from the million line csproj files of past&hellip; and the Git conflicts when checking in code! So frustrating.</p>

<h1 id="hosting-in-azure-don-t-use-webjobs">Hosting in Azure: Don&rsquo;t use WebJobs</h1>

<p>Since I had ported realDonaldTron over as a console application, the right click &ndash;&gt; publish dialog in Visual Studio immediately told me to publish it to Azure as a WebJob in an AppService context. Heck, there&rsquo;s even a free tier - no cost to me! This seemed as if it solved all of my problems, but
I soon learned why this was a bad plan.</p>

<h2 id="webjobs-time-out">WebJobs time out</h2>

<p>Azure WebJobs are a way to run a service, such as a command line application, <em>within the context of a web application</em>. This web application comes with the built-in IIS 20 minute time-out. This means that if you have a service running as a WebJob, and nobody is hitting the URL at which it has
been published (don&rsquo;t worry, Azure generates a cute little web page for you if your WebJob has no web page of its own), then the application pool spins down, taking your service down with it.</p>

<p>For me, this manifested as my application <em>sometimes</em> working soon after I published it (if I had published it with 20 minutes or less before the next hour), other times not working at all (if I had published it in minutes 1 - 40 of an hour), and regardless it would <em>never</em> publish another Tweet
beyond the first 20 minutes.</p>

<h2 id="always-on-isn-t-cheap">Always On isn&rsquo;t cheap</h2>

<p>I Googled my little heart out but could not find much useful documentation on Azure WebJobs. It wasn&rsquo;t until I started exploring the App Service settings in the Azure Portal that I realized I needed to have the <strong>Always On</strong> feature configured (which disables the IIS timeout). But guess
what - you can&rsquo;t turn that on for the lowest two tiers of App Services (free and shared) - you must pay for at least a Basic plan.</p>


<figure>
    
        <img src="/img/app-service-plans.png" />
    
    
    <figcaption>
        <h4>No Always On for you!</h4>
        
    </figcaption>
    
</figure>


<p>And did I mention that Basic plans start at $55 USD per month (assuming Always On and therefore running 24 / 7)?</p>


<figure>
    
        <img src="/img/app-service-basic-plan.png" />
    
    
    <figcaption>
        <h4>I&#39;m not paying that!</h4>
        
    </figcaption>
    
</figure>


<h2 id="webjobs-for-web-sites">WebJobs for web sites</h2>

<p>So while WebJobs are a great option for websites, and App Services can be free or cheap for website hosting (since they will lazy-load whenever someone makes the first request after the 20 minute idle), I realized one important fact:</p>

<p><strong>WebJobs should NEVER be used for services that need to run continuously and/or always be on.</strong></p>

<p>And with that I began Googling Azure alternatives for command line services&hellip; Enter Azure Functions.</p>

<h1 id="hosting-in-azure-use-azure-functions">Hosting in Azure: Use Azure Functions</h1>

<p>Disclaimer: nobody is paying me to talk about Azure or Azure Functions here (though they should). With that said, Azure Functions are <em>awesome</em>.</p>

<h2 id="pricing">Pricing</h2>

<p>Here&rsquo;s the thing about Azure Functions: you pay based on consumption in two ways: total executions, and gigabyte seconds (GB-s). These are defined confusingly:</p>

<blockquote>
<p>Functions are billed based on observed resource consumption measured in gigabyte
seconds (GB-s). Observed resource consumption is calculated by multiplying
average memory size in gigabytes by the time in milliseconds it takes to execute
the function. Memory used by a function is measured by rounding up to the nearest
128 MB, up to the maximum memory size of 1,536 MB, with execution time calculated
by rounding up to the nearest 1 ms. The minimum execution time and memory for a
single function execution is 100 ms and 128 mb respectively.</p>
</blockquote>

<p>While these pricing calculations are confusing, it&rsquo;s not that hard to decipher them. Basically, a really quick execution of an Azure Function (like a &ldquo;Hello World&rdquo;) will cost:</p>

<blockquote>
<p>(100 ms / 1000 ms) * (128 MB RAM / 1024 MB)  = 0.0125 GB-s</p>
</blockquote>

<p>Multiplying that by the cost per GB-s gets you your cost per execution:</p>

<blockquote>
<p>0.0125 GB-s * $0.000016/GB-s = $0.0000002</p>
</blockquote>

<p>Which is <em>far less</em> than a single penny.</p>

<p><strong>In fact, you could execute your &ldquo;Hello, World&rdquo; function 50,000 times before it would cost you $0.01!</strong></p>

<h2 id="monthly-free-grants">Monthly free grants!</h2>

<p>But these crazy cost calculations are not even a concern for most of your and my use cases! Azure Functions pricing includes super generous free grants per month: 1 million executions and 400,000 GB-s!</p>


<figure>
    
        <img src="/img/azure-functions-pricing.png" />
    
    
    <figcaption>
        <h4>Azure Functions pricing</h4>
        
    </figcaption>
    
</figure>


<p>Basically, you&rsquo;d have to run your application 1,000,001 times or for 400,001 GB-s in a month to even begin to see charges to your Azure account.</p>

<h2 id="what-does-realdonaldtron-cost">What does realDonaldTron cost?</h2>

<p>realDonaldTron runs at about 30 seconds per execution, once per hour, so my calculation is:</p>

<blockquote>
<p>30 seconds * 24 runs per day * 31 days in a month * 0.125 GB RAM used = 2,790 GB-s per month.</p>
</blockquote>

<p>This is of course WAY less than the 400,000 GB-s I get for free every month, so realDonaldTron runs for free!</p>

<p>Pretty awesome, right? Basically: you&rsquo;re gonna be hosting all of your Azure Functions for free - JACKPOT. And even if you somehow go over the limits, Azure Functions are stupid cheap.</p>

<h2 id="a-caveat-about-azure-function-logging">A caveat about Azure Function logging</h2>

<p>Note that if you use any of the Logging features of Azure Functions, you WILL pay a small fee as they are written to Azure Storage. realDonaldTron costs about $0.12 per month in Azure Storage logging - and I happily pay it when compared to the $16 a month of Classic Cloud Service I was running.</p>

<p>But enough about costs, let&rsquo;s get to the fun stuff - creating the actual Azure Function!</p>

<h1 id="creating-an-azure-function-in-vs">Creating an Azure Function in VS</h1>

<p>Start by creating a new Azure Function project in Visual Studio (be sure to update to the latest Visual Studio version). My screenshots below are from VS Community 2017 (the free edition) which I use on my home (non-work) computer for pet projects:</p>


<figure>
    
        <img src="/img/vs-new-proj-azure-functions.png" />
    
    
    <figcaption>
        <h4>Create an Azure Functions project</h4>
        
    </figcaption>
    
</figure>


<p>On the next screen, <strong>make sure you pick Azure Functions v2 (.NET Core)</strong> at the top! Azure Functions v1 is for .NET Framework and non-Core apps. I also picked <strong>Timer trigger</strong> because I want realDonaldTron to run every hour, on the hour:</p>


<figure>
    
        <img src="/img/vs-new-proj-azure-functions-2.png" />
    
    
    <figcaption>
        <h4>Create an Azure Functions project</h4>
        
    </figcaption>
    
</figure>


<p>Note that the &ldquo;Schedule&rdquo; here is a modified CRON syntax. I had a hard time finding good resources for CRON scheduling that actually worked in Azure, but <a href="https://codehollow.com/2017/02/azure-functions-time-trigger-cron-cheat-sheet/">this blog post by Armin Reiter</a> is an awesome
cheat sheet that you should definitely use! Also, don&rsquo;t worry about the schedule in this dialog - you can change it programmatically super easily in a minute or two.</p>

<p>Finish up by pressing OK and next you&rsquo;ll see this boilerplate code:</p>

<pre><code>using System;
using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Host;
using Microsoft.Extensions.Logging;

namespace FunctionApp1
{
    public static class Function1
    {
        [FunctionName(&quot;Function1&quot;)]
        public static void Run([TimerTrigger(&quot;0 */5 * * * *&quot;)]TimerInfo myTimer, ILogger log)
        {
            log.LogInformation($&quot;C# Timer trigger function executed at: {DateTime.Now}&quot;);
        }
    }
}
</code></pre>

<p>Feel free to change the class name and namespace here - the only important thing to name is the <code>[FunctionName]</code> attribute as this is what will appear in the Azure Portal UI. You can also see that your CRON syntax from the creation dialog is within the <code>[TimerTrigger]</code> attribute here,
and can be readily modified. The <code>ILogger</code> you see there is the logger that goes to Azure Storage and will cost you a few pennies per month. If you&rsquo;re trying to run truly for free, be sure not to log anything at all.</p>

<p>It&rsquo;s also worth noting that Azure Functions support async entry method signatures, so <code>async</code> your heart out!</p>

<p>Here&rsquo;s what my .NET Core Azure Function Run method for realDonaldTron looks like:</p>

<pre><code>namespace RealDonaldTronFunc
{
    public static class Function
    {
        [FunctionName(&quot;RealDonaldTronFunction&quot;)]
        public async static Task Run([TimerTrigger(&quot;0 0 * * * *&quot;)]TimerInfo myTimer, ILogger log)
        {
            log.LogInformation($&quot;C# Timer trigger function executed at: {DateTime.UtcNow}&quot;);

            // Set Twitter credentials
            var consumerKey = &quot;********&quot;;
            var consumerSecret = &quot;********&quot;;
            var userAccessToken = &quot;********&quot;;
            var userAccessSecret = &quot;********&quot;;
            Auth.SetUserCredentials(consumerKey, consumerSecret, 
                userAccessToken, userAccessSecret);

            // Build the Markhov chain
            Console.WriteLine(&quot;Building Markhov Chain...&quot;);
            BuildMarkhovChain();
            Console.WriteLine(&quot;Built! {0} root nodes&quot;, _markhovTreeRoot.Children.Count);

            // Start generating tweets
            Console.WriteLine(&quot;Starting Tweets...&quot;);
            Console.WriteLine();

            await GenerateTweet();

            log.LogInformation($&quot;C# Timer trigger function completed at: {DateTime.UtcNow}&quot;);
        }
    ...
    }
}
</code></pre>

<p>You might notice that all of my <code>Timer</code> stuff is gone. That&rsquo;s because Azure Functions natively support timed triggers, and the CRON syntax <code>0 0 * * * *</code> says &ldquo;run this every hour, on the hour&rdquo; which completely replaces my need for C# Timers!</p>

<p>Note that unless your function <em>needs</em> to run continuously, you should have it terminate by exiting the <code>Run</code> method as soon as possible. realDonaldTron does not need to remain active - he grabs the latest Tweets and builds a new Markov chain every hour instead. He terminates as
soon as the <code>GenerateTweet()</code> function call returns.</p>

<p>After you&rsquo;ve written your function, it&rsquo;s time to publish it to Azure. Simply right click &ndash;&gt; Publish your project, to be met with this screen:</p>


<figure>
    
        <img src="/img/azure-function-publish.png" />
    
    
    <figcaption>
        <h4>Publish your Azure Function</h4>
        
    </figcaption>
    
</figure>


<p>Press Publish, and on the next screen you&rsquo;ll need to name your function and set up the various resources it&rsquo;ll use. The part to pay attention to here is the <strong>Hosting Plan</strong> which you&rsquo;ll need to be sure is set to <strong>Consumption</strong>:</p>


<figure>
    
        <img src="/img/azure-function-publish-2.png" />
    
    
    <figcaption>
        <h4>Publish your Azure Function</h4>
        
    </figcaption>
    
</figure>



<figure>
    
        <img src="/img/azure-function-publish-3.png" />
    
    
    <figcaption>
        <h4>Publish your Azure Function</h4>
        
    </figcaption>
    
</figure>


<p>Follow the steps past this screen and you&rsquo;ll have your Function published to Azure in mere moments! If you want to test it, but don&rsquo;t want to wait for the timed trigger, you can visit the Azure Portal and run it manually:</p>


<figure>
    
        <img src="/img/azure-portal-functions-run.png" />
    
    
    <figcaption>
        <h4>Test your Azure Function</h4>
        
    </figcaption>
    
</figure>


<p>Here your logging will appear in the debug window below for manual runs - it&rsquo;s quite a nice little tool. If you&rsquo;ve published a function.json (which you will by default), it will not allow you to edit it here which is fine. Just make local changes and re-publish if needed.</p>

<h1 id="the-end-result">The end result</h1>

<p>Thanks to Azure Functions and .NET Core, I now have realDonaldTron running every hour on the hour via CRON scheduling, as an Azure function, well within the monthly free grants provided on Consumption plans. Can you guess on this graph when I converted over to Azure Functions?</p>


<figure>
    
        <img src="/img/azure-billing-example.png" />
    
    
    <figcaption>
        <h4>Azure Functions are free, Classic Cloud Services are not</h4>
        
    </figcaption>
    
</figure>


<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thoughts, condolences and prayers go out to Rallies in order to <a href="https://twitter.com/hashtag/MAGA?src=hash&amp;ref_src=twsrc%5Etfw">#MAGA</a>!</p>&mdash; Donald J. Tron (@realDonaldTron) <a href="https://twitter.com/realDonaldTron/status/1050883816745787393?ref_src=twsrc%5Etfw">October 12, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>Thanks for reading, and enjoy creating your own easy, cheap, and often free Azure Functions!</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/dotnet/">dotnet</a>
          
          <a href="/tags/core/">core</a>
          
          <a href="/tags/csharp/">csharp</a>
          
          <a href="/tags/azure/">azure</a>
          
          <a href="/tags/functions/">functions</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/new-blog-name-and-domain/">
            <span class="next-text nav-default">New Blog Name and Domain</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'haney';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://stackoverflow.com/users/2420979/haney" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://www.twitter.com/haneytron" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/davidahaney" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://www.github.com/haneytron" class="iconfont icon-github" title="github"></a>
  <a href="https://www.davidhaney.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2012 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">David Haney</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001" defer></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js" defer></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js" defer></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js" defer></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.1.1" defer></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-50502107-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>






<script src="/js/custom.js" defer></script>



<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">



<link href="/css/custom.css" rel="stylesheet">

</body>
</html>
